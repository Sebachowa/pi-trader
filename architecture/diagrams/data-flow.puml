@startuml Trading System Data Flow
!theme plain
skinparam backgroundColor #FEFEFE

title Trading System - Real-time Data Flow

participant "Exchange" as exchange
participant "Market Data Service" as mds
queue "Kafka" as kafka
participant "Strategy Engine" as strategy
participant "Risk Manager" as risk
participant "Execution Engine" as execution
participant "Order Management" as oms
database "TimescaleDB" as db

== Market Data Flow ==
exchange -> mds : WebSocket Stream
activate mds
mds -> mds : Normalize Data
mds -> kafka : Publish Market Event
mds -> db : Store Tick Data
deactivate mds

== Signal Generation ==
kafka -> strategy : Market Event
activate strategy
strategy -> strategy : Calculate Indicators
strategy -> strategy : Generate Signal
strategy -> risk : Check Risk Limits
deactivate strategy

== Risk Check ==
activate risk
risk -> risk : Calculate Position Size
risk -> risk : Check Exposure
alt Risk OK
    risk -> execution : Approved Order
else Risk Exceeded
    risk -> strategy : Reject Signal
end
deactivate risk

== Order Execution ==
activate execution
execution -> execution : Route Order
execution -> oms : Send Order
deactivate execution

activate oms
oms -> exchange : Place Order
exchange -> oms : Order Confirmation
oms -> kafka : Order Update Event
deactivate oms

== Position Update ==
kafka -> risk : Update Positions
kafka -> strategy : Execution Feedback
kafka -> db : Store Trade

@enduml